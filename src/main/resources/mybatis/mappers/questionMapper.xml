<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.jhta.pony.dao.QuestionDAO">
	<select id="getAll" resultType="kr.co.jhta.pony.dto.QuestionDTO" parameterType="java.util.HashMap">
    	SELECT questionNo, questionTitle, questionContents, questionFile, questionDate, memberNo, answerStatus
		FROM QUESTION
		WHERE memberNo =#{memberNo}
		LIMIT #{startNo} ,#{endNo}
	</select>

	<select id="getTotal" resultType="int">
		SELECT count(*) cnt
		FROM QUESTION
	</select>
	
	<select id="getAllByAdmin" resultType="kr.co.jhta.pony.dto.QuestionDTO" parameterType="kr.co.jhta.pony.dto.StartEnd">
		SELECT rn, questionNo, questionTitle, questionContents, questionFile, questionDate, memberNo, answerStatus
    	FROM (SELECT ROW_NUMBER() OVER (ORDER BY questionNo DESC) 
    		AS rn, questionNo, questionTitle, questionContents, questionFile, questionDate, memberNo, answerStatus
		        FROM QUESTION) 
		    AS derived
    	WHERE rn BETWEEN #{startNo} AND #{endNo}
	</select> 
	
	
	<select id="selectOne" parameterType="int" resultType="kr.co.jhta.pony.dto.QuestionDTO">
		SELECT * 
		FROM QUESTION
		WHERE questionNo = #{questionNo}
	</select>
	
<<<<<<< HEAD
	<delete id="deleteOne" parameterType="int">
=======
	
	<delete id="deleteOne">
>>>>>>> refs/remotes/origin/yuyu_myPage
		DELETE 
		FROM QUESTION
		WHERE questionNo = #{questionNo}
	</delete>
	

	<insert id="qnaAddOne" parameterType="kr.co.jhta.pony.dto.QuestionDTO">
<<<<<<< HEAD
		INSERT INTO QUESTION (questionTitle, questionContents, questionDate, memberNo, answerStatus)
  		VALUES (#{questionTitle}, #{questionContents}, now(),#{memberNo}, 미답변)
=======
		<!-- INSERT INTO QUESTION (questionTitle, questionContents, questionDate,memberNo)
  		VALUES (#{questionTitle}, #{questionContents}, now(),#{memberNo}) -->
  		
  		  INSERT INTO QUESTION (questionTitle, questionContents, questionFile, questionDate, memberNo, answerStatus)
  		  VALUES (#{questionTitle}, #{questionContents}, NULL, now(),#{memberNo}, '미답변')
		  <!-- SELECT
		    #{questionTitle},
		    #{questionContents},
		    NULL,  blob 타입인 questionFile은 NULL로 설정
		    #{questionDate},
		    M.memberNo,
		    '미답변'
		  FROM
		    MEMBER M
		  WHERE
		    M.memberNo = #{memberNo}; -->
>>>>>>> refs/remotes/origin/yuyu_myPage
	</insert>
	
	<update id="qnaModifyOne" parameterType="kr.co.jhta.pony.dto.QuestionDTO">
		UPDATE QUESTION SET
		questionTitle = #{questionTitle}, questionContents = #{questionContents}, questionDate = now()
		WHERE questionNo = #{questionNo}
	</update>
	<update id="updateAnswerStatus" parameterType="kr.co.jhta.pony.dto.QuestionDTO">
		UPDATE QUESTION
		SET answerStatus = #{answerStatus}
		WHERE questionNo = #{questionNo}
	</update>
	<delete id="deleteCheck" parameterType="String">
		DELETE 
		FROM QUESTION
		WHERE questionNo = #{questionNo}
	</delete>
</mapper>

